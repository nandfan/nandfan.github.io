<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1260px" preserveAspectRatio="none" style="width:349px;height:1260px;" version="1.1" viewBox="0 0 349 1260" width="349px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wbsuk8m3gd9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="234" x="56.5" y="30.8799">vcl_sapi_attach(使用socket)</text><ellipse cx="174" cy="46.0638" fill="#000000" filter="url(#f1wbsuk8m3gd9)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="201" x="73.5" y="76.0638"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="164" x="83.5" y="99.9839">vcl_api_connect_app_socket</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="181" x="83.5" y="117.3601">vcl.conf中的app-socke-api配置项</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="328" x="10" y="150.8161"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="117" x="20" y="174.7362">vcl_api_send_attach</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="308" x="20" y="192.1123">发送attach请求，类型为APP_SAPI_MSG_TYPE_ATTACH</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="104.5" y="225.5683"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="119" x="114.5" y="249.4884">clib_socket_recvmsg</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="114.5" y="266.8645">接受响应</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="80" y="300.3206"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="90" y="324.2407">vcl_api_attach_reply_handler</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="90" y="341.6168">处理响应</text><rect fill="#FFFFFF" filter="url(#f1wbsuk8m3gd9)" height="842.9091" style="stroke: #000000; stroke-width: 2.0;" width="246.5" x="60" y="366.6048"/><path d="M268,367.6048 L268,379.8767 L258,389.8767 L60,389.8767 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="198" x="63" y="383.8447">vcl_api_attach_reply_handler</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="188" x="80" y="456.8406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="116" x="90" y="480.7607">vcl_segment_attach</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="93" y="498.1369">关联到event queues segment</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="84.5,406.8767,263.5,406.8767,275.5,418.8767,263.5,430.8767,84.5,430.8767,72.5,418.8767,84.5,406.8767" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="178" y="443.6366">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="179" x="84.5" y="423.6727">vpp初始化了event queues segment</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="174,531.5929,186,543.5929,174,555.5929,162,543.5929,174,531.5929" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="106" y="625.5568"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="116" x="116" y="649.4769">vcl_segment_attach</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="107" x="119" y="666.853">关联到fifo segment</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="110,575.5929,238,575.5929,250,587.5929,238,599.5929,110,599.5929,98,587.5929,110,575.5929" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="178" y="612.3528">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="128" x="110" y="592.3889">vpp初始化了fifo segment</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="174,700.3091,186,712.3091,174,724.3091,162,712.3091,174,700.3091" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="93.5" y="744.3091"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="141" x="103.5" y="768.2292">vcl_segment_attach_mq</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="129" x="106.5" y="785.6053">关联到app事件消息队列</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="163" x="92.5" y="876.881"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="143" x="102.5" y="900.8011">svm_msq_q_set_eventfd</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="105.5" y="918.1772">设置用来通知的eventfd</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="97.5" y="966.6333"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="133" x="107.5" y="990.5534">vcl_mq_epoll_add_evfd</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="110.5" y="1007.9295">添加到epoll监听事件</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="93.5,819.0613,254.5,819.0613,266.5,834.9892,254.5,850.9171,93.5,850.9171,81.5,834.9892,93.5,819.0613" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="178" y="863.677">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="93.5" y="831.8212">如果指定了使用eventfd通知事件</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="136" x="97.5" y="847.7491">vcl.conf中的use-mq-event</text><polygon fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" points="174,1041.3855,186,1053.3855,174,1065.3855,162,1053.3855,174,1041.3855" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="177" x="85.5" y="1085.3855"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="157" x="95.5" y="1109.3056">vcl_segment_discover_mqs</text><rect fill="#FEFECE" filter="url(#f1wbsuk8m3gd9)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="163" x="92.5" y="1142.7616"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="141" x="102.5" y="1166.6817">vcl_segment_attach_mq</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="105.5" y="1184.0578">关联到vpp的控制消息队列</text><ellipse cx="174" cy="1239.5139" fill="#FFFFFF" filter="url(#f1wbsuk8m3gd9)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 2.5;" x1="167.8128" x2="180.1872" y1="1233.3267" y2="1245.7011"/><line style="stroke: #000000; stroke-width: 2.5;" x1="180.1872" x2="167.8128" y1="1233.3267" y2="1245.7011"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="56.0638" y2="76.0638"/><polygon fill="#A80036" points="170,66.0638,174,76.0638,178,66.0638,174,70.0638" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="130.8161" y2="150.8161"/><polygon fill="#A80036" points="170,140.8161,174,150.8161,178,140.8161,174,144.8161" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="205.5683" y2="225.5683"/><polygon fill="#A80036" points="170,215.5683,174,225.5683,178,215.5683,174,219.5683" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="280.3206" y2="300.3206"/><polygon fill="#A80036" points="170,290.3206,174,300.3206,178,290.3206,174,294.3206" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="430.8767" y2="456.8406"/><polygon fill="#A80036" points="170,446.8406,174,456.8406,178,446.8406,174,450.8406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="275.5" x2="287.5" y1="418.8767" y2="418.8767"/><polygon fill="#A80036" points="283.5,474.2168,287.5,484.2168,291.5,474.2168,287.5,478.2168" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="287.5" x2="287.5" y1="418.8767" y2="543.5929"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="287.5" x2="186" y1="543.5929" y2="543.5929"/><polygon fill="#A80036" points="196,539.5929,186,543.5929,196,547.5929,192,543.5929" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="511.5929" y2="531.5929"/><polygon fill="#A80036" points="170,521.5929,174,531.5929,178,521.5929,174,525.5929" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="599.5929" y2="625.5568"/><polygon fill="#A80036" points="170,615.5568,174,625.5568,178,615.5568,174,619.5568" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="250" x2="262" y1="587.5929" y2="587.5929"/><polygon fill="#A80036" points="258,642.9329,262,652.9329,266,642.9329,262,646.9329" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="262" x2="262" y1="587.5929" y2="712.3091"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="262" x2="186" y1="712.3091" y2="712.3091"/><polygon fill="#A80036" points="196,708.3091,186,712.3091,196,716.3091,192,712.3091" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="680.3091" y2="700.3091"/><polygon fill="#A80036" points="170,690.3091,174,700.3091,178,690.3091,174,694.3091" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="555.5929" y2="575.5929"/><polygon fill="#A80036" points="170,565.5929,174,575.5929,178,565.5929,174,569.5929" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="724.3091" y2="744.3091"/><polygon fill="#A80036" points="170,734.3091,174,744.3091,178,734.3091,174,738.3091" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="931.6333" y2="966.6333"/><polygon fill="#A80036" points="170,956.6333,174,966.6333,178,956.6333,174,960.6333" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="850.9171" y2="876.881"/><polygon fill="#A80036" points="170,866.881,174,876.881,178,866.881,174,870.881" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="266.5" x2="278.5" y1="834.9892" y2="834.9892"/><polygon fill="#A80036" points="274.5,937.1693,278.5,947.1693,282.5,937.1693,278.5,941.1693" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="278.5" x2="278.5" y1="834.9892" y2="1053.3855"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="278.5" x2="186" y1="1053.3855" y2="1053.3855"/><polygon fill="#A80036" points="196,1049.3855,186,1053.3855,196,1057.3855,192,1053.3855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="1021.3855" y2="1041.3855"/><polygon fill="#A80036" points="170,1031.3855,174,1041.3855,178,1031.3855,174,1035.3855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="799.0613" y2="819.0613"/><polygon fill="#A80036" points="170,809.0613,174,819.0613,178,809.0613,174,813.0613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="1065.3855" y2="1085.3855"/><polygon fill="#A80036" points="170,1075.3855,174,1085.3855,178,1075.3855,174,1079.3855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="1122.7616" y2="1142.7616"/><polygon fill="#A80036" points="170,1132.7616,174,1142.7616,178,1132.7616,174,1136.7616" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="355.0728" y2="406.8767"/><polygon fill="#A80036" points="170,396.8767,174,406.8767,178,396.8767,174,400.8767" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="174" x2="174" y1="1197.5139" y2="1229.5139"/><polygon fill="#A80036" points="170,1219.5139,174,1229.5139,178,1219.5139,174,1223.5139" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[031f6eef822abfaa8218ea196764f6a8]
@startuml
title vcl_sapi_attach(使用socket)
start
:vcl_api_connect_app_socket
vcl.conf中的app-socke-api配置项;
:vcl_api_send_attach
发送attach请求，类型为APP_SAPI_MSG_TYPE_ATTACH;
:clib_socket_recvmsg
接受响应;
:vcl_api_attach_reply_handler
处理响应;
partition vcl_api_attach_reply_handler {
  if (vpp初始化了event queues segment) then (yes)
    :vcl_segment_attach
     关联到event queues segment;
  endif
  if (vpp初始化了fifo segment) then (yes)
    :vcl_segment_attach
     关联到fifo segment;
  endif
  :vcl_segment_attach_mq
   关联到app事件消息队列;
  if (如果指定了使用eventfd通知事件
  vcl.conf中的use-mq-event) then (yes)
    :svm_msq_q_set_eventfd
     设置用来通知的eventfd;
    :vcl_mq_epoll_add_evfd
     添加到epoll监听事件;
  endif
  :vcl_segment_discover_mqs;
  :vcl_segment_attach_mq
   关联到vpp的控制消息队列;
}
end
@enduml

PlantUML version 1.2020.02(Sun Mar 01 18:22:07 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.11+9-Debian-1deb12u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>