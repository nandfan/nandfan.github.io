<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="991px" preserveAspectRatio="none" style="width:405px;height:991px;" version="1.1" viewBox="0 0 405 991" width="405px" zoomAndPan="magnify"><defs><filter height="300%" id="fgjvwlpbiwosy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="68" x="167.75" y="30.8799">connect</text><ellipse cx="247.25" cy="46.0638" fill="#000000" filter="url(#fgjvwlpbiwosy)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="70" x="212.25" y="76.0638"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="50" x="222.25" y="99.9839">ldp_init()</text><polygon fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" points="203.25,133.44,291.25,133.44,303.25,145.44,291.25,157.44,203.25,157.44,191.25,145.44,203.25,133.44" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="88" x="203.25" y="150.2359">是否为vls socket?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="174.25" y="142.272">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="303.25" y="142.272">no</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="57.5" y="167.44"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="156" x="67.5" y="191.3601">初始化vppcom_endpt_t结构</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="91" x="67.5" y="208.7362">ip、port、is_ip4</text><rect fill="#FFFFFF" filter="url(#fgjvwlpbiwosy)" height="675.017" style="stroke: #000000; stroke-width: 2.0;" width="273.5" x="10" y="233.7242"/><path d="M99,234.7242 L99,246.9961 L89,256.9961 L10,256.9961 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="13" y="250.9641">vls_connect</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="111.5" y="273.9961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="121.5" y="297.9162">安全检查</text><rect fill="#FFFFFF" filter="url(#fgjvwlpbiwosy)" height="472.4609" style="stroke: #000000; stroke-width: 2.0;" width="251" x="20" y="322.9042"/><path d="M202,323.9042 L202,336.1761 L192,346.1761 L20,346.1761 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="172" x="23" y="340.1441">vppcom_session_connect</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="42.5" y="363.1761"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="186" x="52.5" y="387.0962">获取本socket对应的vcl_session_t</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="79.5" y="420.5522"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="112" x="89.5" y="444.4723">初始化vcl_session_t</text><rect fill="#FFFFFF" filter="url(#fgjvwlpbiwosy)" height="313.9048" style="stroke: #000000; stroke-width: 2.0;" width="231" x="30" y="469.4603"/><path d="M218,470.4603 L218,482.7322 L208,492.7322 L30,492.7322 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="178" x="33" y="486.7003">vcl_send_session_connect</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="53.5" y="509.7322"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="114" x="63.5" y="533.6523">vcl_worker_ctrl_mq</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="164" x="63.5" y="551.0285">获取和vpp通信的控制消息队列</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="211" x="40" y="584.4845"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="50" y="608.4046">app_alloc_ctrl_evt_to_vpp</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="191" x="50" y="625.7807">分配app_session_evt_t成员的内存</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="99.5" y="659.2367"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="109.5" y="683.1568">封装消息数据</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="54.7522" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="59.5" y="716.6129"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="152" x="69.5" y="740.533">app_send_ctrl_evt_to_vpp</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="69.5" y="757.9091">向队列中添加事件</text><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="89.5" y="859.3651"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="92" x="99.5" y="883.2852">阻塞等待vpp返回</text><polygon fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" points="118,815.3651,173,815.3651,185,827.3651,173,839.3651,118,839.3651,106,827.3651,118,815.3651" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="118" y="832.1611">是否非阻塞</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="185" y="824.1971">yes</text><ellipse cx="224" cy="827.3651" fill="#FFFFFF" filter="url(#fgjvwlpbiwosy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="224" cy="827.3651" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" height="37.3761" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="303.5" y="167.44"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="71" x="313.5" y="191.3601">libc_connect</text><polygon fill="#FEFECE" filter="url(#fgjvwlpbiwosy)" points="247.25,914.7412,259.25,926.7412,247.25,938.7412,235.25,926.7412,247.25,914.7412" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="247.25" cy="969.7412" fill="#FFFFFF" filter="url(#fgjvwlpbiwosy)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="247.25" cy="969.7412" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="247.25" x2="247.25" y1="56.0638" y2="76.0638"/><polygon fill="#A80036" points="243.25,66.0638,247.25,76.0638,251.25,66.0638,247.25,70.0638" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="400.5522" y2="420.5522"/><polygon fill="#A80036" points="141.5,410.5522,145.5,420.5522,149.5,410.5522,145.5,414.5522" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="564.4845" y2="584.4845"/><polygon fill="#A80036" points="141.5,574.4845,145.5,584.4845,149.5,574.4845,145.5,578.4845" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="639.2367" y2="659.2367"/><polygon fill="#A80036" points="141.5,649.2367,145.5,659.2367,149.5,649.2367,145.5,653.2367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="696.6129" y2="716.6129"/><polygon fill="#A80036" points="141.5,706.6129,145.5,716.6129,149.5,706.6129,145.5,710.6129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="457.9284" y2="509.7322"/><polygon fill="#A80036" points="141.5,499.7322,145.5,509.7322,149.5,499.7322,145.5,503.7322" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="311.3722" y2="363.1761"/><polygon fill="#A80036" points="141.5,353.1761,145.5,363.1761,149.5,353.1761,145.5,357.1761" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="839.3651" y2="859.3651"/><polygon fill="#A80036" points="141.5,849.3651,145.5,859.3651,149.5,849.3651,145.5,853.3651" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="185" x2="213" y1="827.3651" y2="827.3651"/><polygon fill="#A80036" points="203,823.3651,213,827.3651,203,831.3651,207,827.3651" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="896.7412" y2="926.7412"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="235.25" y1="926.7412" y2="926.7412"/><polygon fill="#A80036" points="225.25,922.7412,235.25,926.7412,225.25,930.7412,229.25,926.7412" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="771.3651" y2="815.3651"/><polygon fill="#A80036" points="141.5,805.3651,145.5,815.3651,149.5,805.3651,145.5,809.3651" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="222.1922" y2="273.9961"/><polygon fill="#A80036" points="141.5,263.9961,145.5,273.9961,149.5,263.9961,145.5,267.9961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="191.25" x2="145.5" y1="145.44" y2="145.44"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="145.5" x2="145.5" y1="145.44" y2="167.44"/><polygon fill="#A80036" points="141.5,157.44,145.5,167.44,149.5,157.44,145.5,161.44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="303.25" x2="349" y1="145.44" y2="145.44"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349" x2="349" y1="145.44" y2="167.44"/><polygon fill="#A80036" points="345,157.44,349,167.44,353,157.44,349,161.44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349" x2="349" y1="204.8161" y2="926.7412"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="349" x2="259.25" y1="926.7412" y2="926.7412"/><polygon fill="#A80036" points="269.25,922.7412,259.25,926.7412,269.25,930.7412,265.25,926.7412" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="247.25" x2="247.25" y1="113.44" y2="133.44"/><polygon fill="#A80036" points="243.25,123.44,247.25,133.44,251.25,123.44,247.25,127.44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="247.25" x2="247.25" y1="938.7412" y2="958.7412"/><polygon fill="#A80036" points="243.25,948.7412,247.25,958.7412,251.25,948.7412,247.25,952.7412" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[714366c2c4453d2769327d87b5b695be]
@startuml
title connect
start
:ldp_init();
if (是否为vls socket?) then (yes)
  :初始化vppcom_endpt_t结构
  ip、port、is_ip4;
  partition vls_connect {
    :安全检查;
     partition vppcom_session_connect {
       :获取本socket对应的vcl_session_t;
       :初始化vcl_session_t;
       partition vcl_send_session_connect {
         :vcl_worker_ctrl_mq
         获取和vpp通信的控制消息队列;
         :app_alloc_ctrl_evt_to_vpp
         分配app_session_evt_t成员的内存;
         :封装消息数据;
         :app_send_ctrl_evt_to_vpp
         向队列中添加事件;
       }
     }
     if (是否非阻塞) then (yes)
       stop
     else
       :阻塞等待vpp返回;
     endif
   }

else (no)
  :libc_connect;
endif
stop
@enduml

PlantUML version 1.2020.02(Sun Mar 01 18:22:07 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.11+9-Debian-1deb12u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>