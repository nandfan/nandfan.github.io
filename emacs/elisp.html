<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
<head>
<!-- 2024-06-23 Sun 15:54 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>smth elisp笔记</title>
<meta name="author" content="nandfan" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">smth elisp笔记</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org788dfa3">1. hello world</a></li>
<li><a href="#orgf659389">2. 基础</a>
<ul>
<li><a href="#org013491d">2.1. 函数和变量</a></li>
<li><a href="#org2c9bfac">2.2. 局部作用域的变量</a></li>
<li><a href="#orgc7dfca9">2.3. lambda表达式</a></li>
<li><a href="#org6476773">2.4. 控制结构</a>
<ul>
<li><a href="#org4efa820">2.4.1. 顺序执行</a></li>
<li><a href="#org882572f">2.4.2. 条件判断</a></li>
<li><a href="#org7a576b2">2.4.3. 循环</a></li>
<li><a href="#org21ddab4">2.4.4. 逻辑运算</a></li>
</ul>
</li>
<li><a href="#orgb85003a">2.5. 函数列表</a></li>
</ul>
</li>
<li><a href="#orgd991b66">3. 基本数据类型&#x2013;数字</a>
<ul>
<li><a href="#orgddf6347">3.1. 测试函数</a></li>
<li><a href="#org105eae4">3.2. 数的比较</a></li>
<li><a href="#org235cf00">3.3. 数的转换</a></li>
<li><a href="#orgdac0dd6">3.4. 数的运算</a></li>
<li><a href="#org41a896c">3.5. 函数列表</a></li>
<li><a href="#org02139d2">3.6. 变量列表</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="http://smacs.github.io/elisp/">http://smacs.github.io/elisp/</a>
</p>

<div id="outline-container-org788dfa3" class="outline-2">
<h2 id="org788dfa3"><span class="section-number-2">1.</span> hello world</h2>
<div class="outline-text-2" id="text-1">
<p>
首先切换到 <b>scratch</b> 缓冲区：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #E6DB74;">"hello world"</span>)
</pre>
</div>

<p>
在括号后键入： <code>C-j</code> 执行该表达式。
</p>

<p>
<code>C-x C-e</code> 是一个全局按键绑定，也可以执行表达式。
</p>
</div>
</div>
<div id="outline-container-orgf659389" class="outline-2">
<h2 id="orgf659389"><span class="section-number-2">2.</span> 基础</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org013491d" class="outline-3">
<h3 id="org013491d"><span class="section-number-3">2.1.</span> 函数和变量</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">function-name</span> (arguments-list)
  <span style="color: #E6DB74;">"document string"</span>
  body)

<span style="color: #75715E;">;;</span><span style="color: #75715E;">&#20363;&#22914;&#65306;</span>
(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">hello-world</span> (name)
  <span style="color: #E6DB74;">"Say hello to user whose name is NAME."</span>
  (message <span style="color: #E6DB74;">"hello, %s"</span> name))
</pre>
</div>
<p>
emacs中，光标处于函数名上时， <code>C-h f</code> 可以查看函数的文档介绍（显示在 <code>help</code> 缓冲区）。
</p>

<p>
运行函数：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(function-name arguments-list)

<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#20363;&#22914;&#20043;&#21069;&#30340;hello-world&#31034;&#20363;&#65306;</span>
(hello-world <span style="color: #E6DB74;">"nandfan"</span>)             <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "hello, nandfan"</span>
</pre>
</div>

<p>
每个函数都有一个返回值，返回值一般是函数定义里的最后一个表达式的值。
</p>

<p>
elisp中变量无需声明，可以直接使用 <code>setq</code> 赋值：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">setq</span> foo <span style="color: #E6DB74;">"I'm foo"</span>)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "I'm foo"</span>
(message foo)                         <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "I'm foo"</span>
</pre>
</div>

<p>
<code>C-h v</code> 可以查看光标处的变量，或者输入变量名查找。
</p>

<p>
<code>defvar</code> 可以声明一个变量，如果此前变量已经有值，则不会覆盖。同时还可以为变量提供描述（ <code>C-h v</code> 查看）。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">variable-name</span> value
  <span style="color: #E6DB74;">"document string"</span>)

<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#20363;&#22914;&#65292;&#27492;&#21069;&#25105;&#20204;&#24050;&#32463;&#23450;&#20041;&#20102;foo&#65306;</span>
(<span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">foo</span> <span style="color: #E6DB74;">"Did I have a value?"</span>     <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; foo</span>
  <span style="color: #E6DB74;">"A demo variable"</span>)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "I'm foo"</span>

(<span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">bar</span> <span style="color: #E6DB74;">"I'm bar"</span>                 <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; bar</span>
  <span style="color: #E6DB74;">"A demo variable name \"bar\""</span>)     <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "I'm bar"</span>
</pre>
</div>

<p>
elisp中函数是全局的，变量很容易成为全局变量（全局变量和局部变量的赋值都是使用 <code>setq</code> 函数），因此要确保名称不会冲突。因此推荐为函数和变量选择一个合适的前缀，并且在定义前用 <code>C-h f</code> 和 <code>C-h v</code> 查看一下函数名和变量名是否已经被定义。
</p>
</div>
</div>

<div id="outline-container-org2c9bfac" class="outline-3">
<h3 id="org2c9bfac"><span class="section-number-3">2.2.</span> 局部作用域的变量</h3>
<div class="outline-text-3" id="text-2-2">
<p>
使用 <code>let</code> 和 <code>let*</code> 进行局部变量的绑定：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">let</span> (bingings)
  body)
</pre>
</div>
<p>
<code>bingdings</code> 可以是 <code>(var value)</code> 这种为 <code>var</code> 赋值的形式，或者只通过 <code>var</code> 声明一个初始值为 nil的变量。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">circle-area</span> (radix)
  (<span style="color: #F92672;">let</span> ((pi 3.1415926)                <span style="color: #75715E;">;; </span><span style="color: #75715E;">pi&#20026;4.1415926</span>
        area)                         <span style="color: #75715E;">;; </span><span style="color: #75715E;">area &#20026; nil</span>
    (<span style="color: #F92672;">setq</span> area (* pi radix radix))
    (message <span style="color: #E6DB74;">"&#30452;&#24452;&#20026; %.2f &#30340;&#22278;&#38754;&#31215;&#26159; %.2f"</span> radix area)))
(circle-area 3)
</pre>
</div>

<p>
<code>let*</code> 和 <code>let</code> 的使用形式相同，但是 <code>let*</code> 能在声明中直接使用变量，比如：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">cirle-area</span> (radix)
  (<span style="color: #F92672;">let*</span> ((pi 3.1415926)
         (area (* pi radix radix)))
    (message <span style="color: #E6DB74;">"&#30452;&#24452;&#20026; %.2f &#30340;&#22278;&#38754;&#31215;&#26159; %.2f"</span> radix area)))
</pre>
</div>
</div>
</div>


<div id="outline-container-orgc7dfca9" class="outline-3">
<h3 id="orgc7dfca9"><span class="section-number-3">2.3.</span> lambda表达式</h3>
<div class="outline-text-3" id="text-2-3">
<p>
lambda表达式相当于其他语言中的匿名函数，例如perl的匿名函数。
</p>

<p>
elisp的 <code>lambda</code> 表达式形式和 <code>defun</code> 形式一样：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">lambda</span> (arguments-list)
  <span style="color: #E6DB74;">"documentation string"</span>
  body)
</pre>
</div>

<p>
调用 <code>lambda</code> ：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(funcall (<span style="color: #F92672;">lambda</span> (name)
           (message <span style="color: #E6DB74;">"Hello, %s!"</span> name)) <span style="color: #FD971F; font-weight: bold; font-style: italic; text-decoration: underline;">"nandfan"</span><span style="color: #FD971F; font-weight: bold; font-style: italic; text-decoration: underline;">)</span>
</pre>
</div>

<p>
可以将 <code>lambda</code> 表达式赋值给变量，然后通过 <code>funcall</code> 调用：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">setq</span> foo (<span style="color: #F92672;">lambda</span> (name)
            (message <span style="color: #E6DB74;">"Hello, %s!"</span> name)))
(funcall foo <span style="color: #E6DB74;">"nandfan"</span>)
</pre>
</div>

<p>
<code>lambda</code> 表达式最常用的是作为参数传递给其它函数，比如 mapc。
</p>
</div>
</div>

<div id="outline-container-org6476773" class="outline-3">
<h3 id="org6476773"><span class="section-number-3">2.4.</span> 控制结构</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org4efa820" class="outline-4">
<h4 id="org4efa820"><span class="section-number-4">2.4.1.</span> 顺序执行</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
<code>progn</code> 表达式可以用于顺序执行表达式：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">progn</span>
  (<span style="color: #F92672;">setq</span> foo 3)
  (message <span style="color: #E6DB74;">"Square of %d is %d"</span> foo (* foo foo)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org882572f" class="outline-4">
<h4 id="org882572f"><span class="section-number-4">2.4.2.</span> 条件判断</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
elisp中最基本的两个条件判断表达式 <code>if</code> 和 <code>cond</code> 。使用形式如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">if</span> condition
    then
  else)

(<span style="color: #F92672;">cond</span> (case1 do-when-case1)
      (case2 do-when-case2)
      ...
      (t do-when-none-meet))
</pre>
</div>

<p>
例如：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">my-max</span> (a b)
  (<span style="color: #F92672;">if</span> (&gt; a b)
      a b))
(my-max 3 4)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 4</span>

(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">fib</span> (n)
  (<span style="color: #F92672;">cond</span> ((= n 0) 0)
        ((= n 1) 1)
        (t (+ (fib (- n 1))
              (fib (- n 2))))))
(fib 10)                      <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 55</span>
</pre>
</div>

<p>
还有两个宏 <code>when</code> 和 <code>unless</code> ， <code>when</code> 能省去 <code>if</code> 里的 <code>progn</code> 结构， <code>unless</code> 省去条件为真子句需要的 <code>nil</code> 表达式。
</p>
</div>
</div>

<div id="outline-container-org7a576b2" class="outline-4">
<h4 id="org7a576b2"><span class="section-number-4">2.4.3.</span> 循环</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
循环使用 <code>while</code> 表达式：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">factorial</span> (n)
  (<span style="color: #F92672;">let</span> ((res 1))
    (<span style="color: #F92672;">while</span> (&gt; n 1)
      (<span style="color: #F92672;">setq</span> res (* res n)
            n (- n 1)))
    res))
(factorial 10)                        <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 3628800</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org21ddab4" class="outline-4">
<h4 id="org21ddab4"><span class="section-number-4">2.4.4.</span> 逻辑运算</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
条件的逻辑运算和其它语言类似，使用 and、or、not。 and 和 or 也同样具有短路性质。很多人喜欢在表达式短时，用 and 代替 when，or 代替 unless。当然这时一般不关心它们的返回值，而是在于表达式其它子句的副作用。比如 or 经常用于设置函数的缺省值，而 and 常用于参数检查：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">hello-world</span> (<span style="color: #66D9EF;">&amp;optional</span> name)
  (<span style="color: #F92672;">or</span> name (<span style="color: #F92672;">setq</span> name <span style="color: #E6DB74;">"nandfan"</span>))
  (message <span style="color: #E6DB74;">"Hello, %s"</span> name))                 <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; hello-world</span>
(hello-world)                                 <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "Hello, nandfan"</span>
(hello-world <span style="color: #E6DB74;">"fanyf"</span>)                         <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; "Hello, fanyf"</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">square-number-p</span> (n)
  (<span style="color: #F92672;">and</span> (&gt;= n 0)
       (= (/ n (sqrt n)) (sqrt n))))          <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; square-number-p</span>
(square-number-p -1)                          <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; nil</span>
(square-number-p 25)                          <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb85003a" class="outline-3">
<h3 id="orgb85003a"><span class="section-number-3">2.5.</span> 函数列表</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">NAME</span> ARGLIST [DOCSTRING] BODY...)
(<span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">SYMBOL</span> <span style="color: #66D9EF;">&amp;optional</span> INITVALUE DOCSTRING)
(<span style="color: #F92672;">setq</span> SYM VAL SYM VAL ...)
(<span style="color: #F92672;">let</span> VARLIST BODY...)
(<span style="color: #F92672;">let*</span> VARLIST BODY...)
(<span style="color: #F92672;">lambda</span> ARGS [DOCSTRING] [INTERACTIVE] BODY)
(<span style="color: #F92672;">progn</span> BODY ...)
(<span style="color: #F92672;">if</span> COND THEN ELSE...)
(<span style="color: #F92672;">cond</span> CLAUSES...)
(<span style="color: #F92672;">when</span> COND BODY ...)
(<span style="color: #F92672;">unless</span> COND BODY ...)
(<span style="color: #F92672;">when</span> COND BODY ...)
(<span style="color: #F92672;">or</span> CONDITIONS ...)
(<span style="color: #F92672;">and</span> CONDITIONS ...)
(not OBJECT)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd991b66" class="outline-2">
<h2 id="orgd991b66"><span class="section-number-2">3.</span> 基本数据类型&#x2013;数字</h2>
<div class="outline-text-2" id="text-3">
<p>
elisp 里的对象都是有类型的，而且每一个对象它们知道自己是什么类型。
</p>

<p>
内建的 emacs 数据类型称为 primitive types，包括整数、浮点数、cons、符号(symbol)、字符串、向量(vector)、散列表(hash-table)、subr（内建函数，比如 cons, if, and 之类）、byte-code function，和其它特殊类型，例如缓冲区（buffer）。
</p>

<p>
读入语法：所谓读入语法是让 elisp 解释器明白输入字符所代表的对象，简单的来说，一种数据类型有（也可能没有，比如散列表）对应的规则来让解释器产生这种数据类型，比如 123 产生整数 123，(a . b) 产生一个 cons。
</p>

<p>
输出形式：所谓输出形式是解释器用产生一个字符串来表示一个数据对象。比如整数 123 的输出形式就是 123， <code>cons cell (a . b)</code> 的输出形式是 <code>(a . b)</code> 。
</p>

<p>
输出形式与读入语法不同的是，数据对象都有输出形式。比如散列表的输出可能是这样的：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#&lt;hash-table 'eql nil 0/65 0xa7344c8&gt;
</pre>
</div>

<p>
通常一个对象的数据对象的输出形式和它的读入形式都是相同的。
</p>

<p>
现在就先从简单的数据类型──数字开始：emacs 的数字分为整数和浮点数（和 C 比没有双精度数 double）。1， 1.，+1, -1, 536870913, 0, -0 这些都是整数。整数的范围是和机器是有关的，一般来最小范围是在 -268435456 to 268435455（29位，-2**28 ~ 2**28-1）。可以从 <code>most-positive-fixnum</code> 和 <code>most-negative-fixnum</code> 两个变量得到整数的范围。
</p>

<p>
可以用多种进制来输入一个整数：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#b101100 =&gt; 44      <span style="color: #75715E;">; </span><span style="color: #75715E;">&#20108;&#36827;&#21046;</span>
#o54 =&gt; 44          <span style="color: #75715E;">; </span><span style="color: #75715E;">&#20843;&#36827;&#21046;</span>
#x2c =&gt; 44          <span style="color: #75715E;">; </span><span style="color: #75715E;">&#21313;&#36827;&#21046;</span>
</pre>
</div>

<p>
最神奇的是你可以用 2 到 36 之间任意一个数作为基数（0-9 a-z 总共36个字符），比如：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#24r1k =&gt; 44        <span style="color: #75715E;">; </span><span style="color: #75715E;">&#20108;&#21313;&#22235;&#36827;&#21046;</span>
</pre>
</div>

<p>
1500.0, 15e2, 15.0e2, 1.5e3, 和 .15e4 都可以用来表示一个浮点数 1500.。遵循 IEEE 标准，elisp 也有一个特殊类型的值称为 NaN(not-a-number)。你可以用 (/ 0.0 0.0) 产生这个数。
</p>
</div>

<div id="outline-container-orgddf6347" class="outline-3">
<h3 id="orgddf6347"><span class="section-number-3">3.1.</span> 测试函数</h3>
<div class="outline-text-3" id="text-3-1">
<p>
整数类型测试函数： <code>integerp</code> ，浮点数类型测试函数： <code>floatp</code> 。数字类型测试用 <code>numberp</code> 。测试是否是零： <code>zerop</code> ，非负整数测试： <code>wholenump</code> 。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(integerp 1.)                           <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
(integerp 1.0)                          <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; nil</span>
(floatp 1.)                             <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; nil</span>
(floatp -0.0e+NaN)                      <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
(numberp 1)                             <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
</pre>
</div>

<p>
注：elisp 测试函数一般都是用 p 来结尾，p 是 predicate 的第一个字母。如果函数名是一个单词，通常只是在这个单词后加一个 p，如果是多个单词，一般是加 -p。
</p>
</div>
</div>

<div id="outline-container-org105eae4" class="outline-3">
<h3 id="org105eae4"><span class="section-number-3">3.2.</span> 数的比较</h3>
<div class="outline-text-3" id="text-3-2">
<p>
常用比较符 &lt;，&gt;，&gt;=，&lt;=，注意 = 用于测试数字是否相等，赋值操作则使用set函数。
</p>

<p>
对于浮点数的相等测试，结果是不可靠的：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">setq</span> foo (- (+ 1.0 1.0e-3) 1.0))       <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 0.0009999999999998899</span>
(<span style="color: #F92672;">setq</span> bar 1.0e-3)                       <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 0.001</span>
(= foo bar)                             <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; nil</span>
</pre>
</div>

<p>
浮点数的相等测试需要在一定误差内比较：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">setq</span> foo (- (+ 1.0 1.0e-3) 1.0))       <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 0.0009999999999998899</span>
(<span style="color: #F92672;">setq</span> bar 1.0e-3)                       <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 0.001</span>
(<span style="color: #F92672;">defvar</span> <span style="color: #FD971F;">fuzz-factor</span> 1.0e-6)
(<span style="color: #F92672;">defun</span> <span style="color: #A6E22E;">approx-equal</span> (x y)
  (<span style="color: #F92672;">or</span> (<span style="color: #F92672;">and</span> (= x 0) (= y 0))
      (&lt; (/ (abs (- x y))
            (max (abs x) (abs y)))
         fuzz-factor)))
(approx-equal foo bar)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
</pre>
</div>

<p>
测试数字类型是否一致 <code>eql</code> ：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(= 1.0 1)                               <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; t</span>
(eql 1.0 1)                             <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; nil</span>
</pre>
</div>

<p>
elisp 没有 +=, -<code>, /</code>, *= 这样的命令式语言里常见符号，只能用赋值函数 setq 来实现类似功能了。 /= 符号被用来作为不等于的测试。
</p>
</div>
</div>

<div id="outline-container-org235cf00" class="outline-3">
<h3 id="org235cf00"><span class="section-number-3">3.3.</span> 数的转换</h3>
<div class="outline-text-3" id="text-3-3">
<p>
整数向浮点数转换是通过 <code>float</code> 函数进行。
</p>

<p>
浮点数转换成整数有这样几个函数：
</p>
<ul class="org-ul">
<li>truncate 转换成靠近 0 的整数</li>
<li>floor 转换成最接近的不比本身大的整数</li>
<li>ceiling 转换成最接近的不比本身小的整数</li>
<li>round 四舍五入后的整数，换句话说和它的差绝对值最小的整数</li>
</ul>

<p>
详细内容可以查看 info，按键顺序是 <code>C-h i m elisp RET m Numeric Conversions RET</code> 。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(truncate 1.2)                <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 1</span>
(floor 1.2)                   <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 1</span>
(ceiling 1.2)                 <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 2</span>
(round 1.2)                   <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 1</span>

(truncate 1.7)                <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 1</span>
(floor 1.7)                   <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 1</span>
(ceiling 1.7)                 <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 2</span>
(round 1.7)                   <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 2</span>

(truncate -1.2)               <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -1</span>
(floor -1.2)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -2</span>
(ceiling -1.2)                <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -1</span>
(round -1.2)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -1</span>

(truncate -1.7)               <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -1</span>
(floor -1.7)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -2</span>
(ceiling -1.7)                <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -1</span>
(round -1.7)                  <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; -2</span>

</pre>
</div>
</div>
</div>


<div id="outline-container-orgdac0dd6" class="outline-3">
<h3 id="orgdac0dd6"><span class="section-number-3">3.4.</span> 数的运算</h3>
<div class="outline-text-3" id="text-3-4">
<p>
四则运算： +、-、*、/。
</p>

<p>
参数都是整数时，除法会转换为整数。参数中有浮点数，则转换为浮点数。
</p>

<p>
<code>++</code> 和 <code>--</code> 操作则分别使用 <code>1+</code> <code>1-</code> 函数代替：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #F92672;">setq</span> foo 10)
(<span style="color: #F92672;">setq</span> foo (1+ foo))           <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 11</span>
(<span style="color: #F92672;">setq</span> foo (1- foo))           <span style="color: #75715E;">; </span><span style="color: #75715E;">=&gt; 10</span>
</pre>
</div>

<p>
<code>abs</code> 取数的绝对值。
</p>

<p>
有两个取模的函数， <code>%</code> 和 <code>mod</code> ， <code>%</code> 首个参数必须是整数，而 <code>mod</code> 的首个参数可以是整数，可以是浮点数。
</p>

<p>
三角运算有函数： <code>sin</code> 、 <code>cos</code> 、 <code>tan</code> 、 <code>asin</code> 、 <code>acos</code> 、 <code>atan</code> 。开方函数是 <code>sqrt</code> 。
</p>

<p>
<code>exp</code> 是以 <code>e</code> 为底的指数运算， <code>expt</code> 可以指定底数的指数运算。 <code>log</code> 默认底数是 <code>e</code> ，但是也可以指定底数。 <code>log10</code> 就是 <code>(log x 10)</code> 。 <code>logb</code> 是以 2 为底数运算，但是返回的是一个整数。这个函数是用来计算数的位。
</p>

<p>
<code>random</code> 可以产生随机数。可以用 <code>(random t)</code> 来产生一个新种子。虽然 emacs 每次启动后调用 <code>random</code> 总是产生相同的随机数，但是运行过程中，你不知道调用了多少次，所以使用时还是不需要再调用一次 <code>(random t)</code> 来产生新的种子。
</p>

<p>
位运算的操作查看： info 帮助文档。
</p>
</div>
</div>

<div id="outline-container-org41a896c" class="outline-3">
<h3 id="org41a896c"><span class="section-number-3">3.5.</span> 函数列表</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #75715E;">;; </span><span style="color: #75715E;">&#27979;&#35797;&#20989;&#25968;</span>
(integerp OBJECT)
(floatp OBJECT)
(numberp OBJECT)
(zerop NUMBER)
(wholenump OBJECT)
<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#27604;&#36739;&#20989;&#25968;</span>
(&gt; NUM1 NUM2)
(&lt; NUM1 NUM2)
(&gt;= NUM1 NUM2)
(&lt;= NUM1 NUM2)
(= NUM1 NUM2)
(eql OBJ1 OBJ2)
(/= NUM1 NUM2)
<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#36716;&#25442;&#20989;&#25968;</span>
(float ARG)
(truncate ARG <span style="color: #66D9EF;">&amp;optional</span> DIVISOR)
(floor ARG <span style="color: #66D9EF;">&amp;optional</span> DIVISOR)
(ceiling ARG <span style="color: #66D9EF;">&amp;optional</span> DIVISOR)
(round ARG <span style="color: #66D9EF;">&amp;optional</span> DIVISOR)
<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#36816;&#31639;</span>
(+ <span style="color: #66D9EF;">&amp;rest</span> NUMBERS-OR-MARKERS)
(- <span style="color: #66D9EF;">&amp;optional</span> NUMBER-OR-MARKER <span style="color: #66D9EF;">&amp;rest</span> MORE-NUMBERS-OR-MARKERS)
(* <span style="color: #66D9EF;">&amp;rest</span> NUMBERS-OR-MARKERS)
(/ DIVIDEND DIVISOR <span style="color: #66D9EF;">&amp;rest</span> DIVISORS)
(1+ NUMBER)
(1- NUMBER)
(abs ARG)
(% X Y)
(mod X Y)
(sin ARG)
(cos ARG)
(tan ARG)
(asin ARG)
(acos ARG)
(atan Y <span style="color: #66D9EF;">&amp;optional</span> X)
(sqrt ARG)
(exp ARG)
(expt ARG1 ARG2)
(log ARG <span style="color: #66D9EF;">&amp;optional</span> BASE)
(log10 ARG)
(logb ARG)
<span style="color: #75715E;">;; </span><span style="color: #75715E;">&#38543;&#26426;&#25968;</span>
(random <span style="color: #66D9EF;">&amp;optional</span> N)
</pre>
</div>
</div>
</div>


<div id="outline-container-org02139d2" class="outline-3">
<h3 id="org02139d2"><span class="section-number-3">3.6.</span> 变量列表</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">most-positive-fixnum
most-negative-fixnum
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: nandfan</p>
<p class="email">Email: <a href="mailto:nanders.fan@outlook.com">nanders.fan@outlook.com</a></p>
<p class="date">Created: 2024-06-23 Sun 15:54</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
